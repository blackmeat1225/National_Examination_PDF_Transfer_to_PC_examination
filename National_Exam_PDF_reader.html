<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>åœ‹è€ƒç­”æ¡ˆå·/å•å·ç¨ç«‹åˆ‡å‰²ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        :root { 
            --primary: #3498db; 
            --success: #27ae60; 
            --warning: #e67e22; 
            --danger: #ff4d4d; 
            --ans-bg: #e8f4fc; 
            --quiz-bg: #fff3e0;
            --dark: #2c3e50; 
            --bg: #f4f7f6; 
        }
        body { 
            font-family: "Microsoft JhengHei", sans-serif; 
            background: var(--bg); 
            display: flex; 
            gap: 20px; 
            margin: 0; 
            height: 100vh; 
            overflow: hidden; 
            padding: 15px; 
            box-sizing: border-box; 
        }
        
        .sidebar { 
            width: 420px; 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            overflow-y: auto; 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
        }
        
        .main-content { 
            flex: 1; 
            background: #fff; 
            padding: 25px; 
            border-radius: 12px; 
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05); 
            overflow-y: auto; 
            height: 100%; 
            border: 2px solid #eee; 
            position: relative; 
        }

        .status-box { 
            background: var(--dark); 
            color: #fff; 
            padding: 15px; 
            border-radius: 8px; 
            text-align: center; 
            margin-bottom: 15px; 
        }
        
        #timer-display { 
            font-family: monospace; 
            font-size: 28px; 
            font-weight: bold; 
            display: block; 
            color: #5dade2; 
        }
        
        .parse-stats { 
            font-size: 13px; 
            margin-top: 8px; 
            color: #ccc; 
            border-top: 1px solid #444; 
            padding-top: 8px; 
        }

        /* æª”æ¡ˆç®¡ç† */
        .file-management {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
        }
        
        .file-type-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .file-type-btn {
            flex: 1;
            padding: 10px;
            background: #e9ecef;
            border: 2px solid #adb5bd;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            font-weight: bold;
        }
        
        .file-type-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .ans-type { background: var(--ans-bg); border-color: var(--primary); }
        .quiz-type { background: var(--quiz-bg); border-color: var(--warning); }
        
        /* åˆ‡å‰²åƒæ•¸é¢æ¿ */
        .cut-config-panel {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid #3498db;
            position: relative;
        }
        
        .cut-config-panel.ans-config { border-color: var(--primary); }
        .cut-config-panel.quiz-config { border-color: var(--warning); border-left: 5px solid var(--warning); }
        
        .cut-config-panel h4 { 
            margin-top: 0; 
            color: var(--dark); 
            font-size: 14px; 
            margin-bottom: 10px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .config-tag {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            color: white;
            font-weight: normal;
        }
        
        .ans-tag { background: var(--primary); }
        .quiz-tag { background: var(--warning); }
        
        .cut-param-group { 
            margin-bottom: 12px; 
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .cut-param-group label { 
            display: flex; 
            justify-content: space-between; 
            font-weight: bold; 
            margin-bottom: 5px; 
            font-size: 12px;
        }
        
        .cut-param-group input[type="range"] { 
            width: 100%; 
            cursor: pointer; 
            height: 6px;
            border-radius: 3px;
        }
        
        .cut-param-group .param-value { 
            font-family: monospace; 
            background: white; 
            padding: 2px 8px; 
            border-radius: 10px; 
            border: 1px solid #ddd;
            min-width: 40px;
            text-align: center;
        }
        
        /* é è¦½é¢æ¿ */
        .preview-panel { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 15px; 
            border: 1px solid #dee2e6; 
            max-height: 300px; 
            overflow-y: auto; 
        }
        
        .preview-panel h5 { 
            margin-top: 0; 
            color: var(--dark); 
            font-size: 13px; 
            margin-bottom: 10px;
        }
        
        .preview-text { 
            font-family: monospace; 
            font-size: 10px; 
            line-height: 1.3; 
            white-space: pre-wrap; 
            background: white; 
            padding: 10px; 
            border-radius: 5px; 
            border: 1px solid #ddd; 
        }
        
        .preview-line { 
            margin: 2px 0; 
        }
        
        .preview-line.highlight { 
            background: #fff3cd; 
        }
        
        /* ç­”æ¡ˆç¶²æ ¼ */
        .ans-panel { 
            background: #f8f9fa; /* å¾ç¶ è‰²æ”¹ç‚ºä¸­æ€§ç°è‰² */
            padding: 12px; 
            border-radius: 8px; 
            border: 1px solid #dee2e6; /* å¾ç¶ è‰²æ”¹ç‚ºç°è‰² */
            margin-bottom: 15px; 
        }
        
        .ans-grid { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 4px; 
            margin-top: 10px; 
            background: #fff; 
            padding: 5px; 
            border: 1px solid #ddd; 
            height: 350px; 
            overflow-y: auto; 
        }
        
        .ans-unit { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            border: 1px solid #eee; 
            padding: 2px; 
            border-radius: 4px; 
            font-size: 11px; 
            background: white; /* ç¢ºä¿ç™½è‰²èƒŒæ™¯ */
        }
        
        .ans-unit.multi-letter { 
            background-color: #fff3e0; /* æ”¹ç‚ºè¼ƒæ·¡çš„è­¦ç¤ºè‰² */
            border: 1px solid var(--warning); 
        }
        
        .ans-unit.cut-problem { 
            background-color: #fff0f0; /* æ”¹ç‚ºè¼ƒæ·¡çš„éŒ¯èª¤è‰² */
            border: 1px solid #ffcccc; 
        }
        
        .ans-unit input { 
            width: 45px; 
            text-align: center; 
            font-size: 12px; 
            font-weight: bold; 
            color: var(--primary); 
            border: 1px solid #ccc; 
            background: white; /* è¼¸å…¥æ¡†ç™½è‰²èƒŒæ™¯ */
        }
        
        .btn-mode { 
            background: var(--dark); 
            color: white; 
            border: none; 
            padding: 10px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: bold; 
            width: 100%; 
            margin-bottom: 15px; 
        }
        
        .file-item { 
            padding: 8px; 
            border-bottom: 1px solid #eee; 
            font-size: 13px; 
            cursor: pointer; 
        }
        
        .file-item.active { 
            background: #e3f2fd; 
            font-weight: bold; 
            border-left: 4px solid var(--primary); 
        }
        
        .btn-blue { 
            background: var(--primary); 
            color: white; 
            width: 100%; 
            border:none; 
            padding:15px; 
            border-radius:6px; 
            cursor:pointer; 
            font-weight:bold; 
        }

        /* é¡Œç›®é¡¯ç¤ºå€åŸŸ - ç§»é™¤é è¨­ç¶ è‰²åº•è‰² */
        .quiz-card { 
            border-left: 6px solid var(--primary); 
            padding: 20px; 
            margin-bottom: 20px; 
            background: #fff; /* ç¢ºä¿ç™½è‰²èƒŒæ™¯ */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            transition: all 0.3s ease;
        }
        
        /* åªåœ¨å°ç­”æ¡ˆæ™‚æ‰é¡¯ç¤ºé¡è‰² */
        .quiz-card.correct { 
            background-color: #f0fff0 !important; /* æ”¹ç‚ºè¼ƒæ·¡çš„ç¶ è‰² */
            border-left-color: #28a745 !important; 
        }
        
        .quiz-card.incorrect { 
            background-color: #fff0f0 !important; /* æ”¹ç‚ºè¼ƒæ·¡çš„ç´…è‰² */
            border-left-color: #dc3545 !important; 
        }
        
        .quiz-card.unanswered { 
            background-color: #f9f9f9 !important; /* æ”¹ç‚ºè¼ƒæ·¡çš„ç°è‰² */
            border-left-color: #6c757d !important; 
        }
        
        .options-list label { 
            display: block; 
            padding: 10px; 
            margin: 5px 0; 
            border: 1px solid #e0e0e0; 
            border-radius: 6px; 
            cursor: pointer; 
            transition: all 0.2s ease;
            background: white; /* ç¢ºä¿ç™½è‰²èƒŒæ™¯ */
        }
        
        .options-list label:hover { 
            background-color: #f5f5f5; 
        }
        
        /* åªåœ¨é¸æ“‡æˆ–å°ç­”æ¡ˆæ™‚é¡¯ç¤ºé¡è‰² */
        .options-list label.selected { 
            background-color: #e6f2ff; /* æ”¹ç‚ºè¼ƒæ·¡çš„è—è‰² */
            border-color: #007bff; 
        }
        
        .options-list label.correct-option { 
            background-color: #e7f7e7 !important; /* æ”¹ç‚ºè¼ƒæ·¡çš„ç¶ è‰² */
            border-color: #28a745 !important; 
        }
        
        .options-list label.incorrect-option { 
            background-color: #fdeaea !important; /* æ”¹ç‚ºè¼ƒæ·¡çš„ç´…è‰² */
            border-color: #dc3545 !important; 
        }
        
        .correct-ans { 
            display: none; 
            margin-top: 10px; 
            padding: 10px; 
            border-radius: 5px; 
            font-weight: bold; 
            background: #fff; 
            color: #27ae60; 
            border: 1px dashed #27ae60; 
        }
        
        /* åŒ¯å‡ºæŒ‰éˆ• */
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .export-buttons button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .cut-visualization {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .config-summary {
            background: #f8f9fa; /* æ”¹ç‚ºä¸­æ€§ç°è‰² */
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 11px;
            border: 1px solid #dee2e6;
        }
        
        .update-status {
            background: #f0f9ff; /* æ”¹ç‚ºè¼ƒæ·¡çš„è—è‰² */
            color: #0056b3;
            padding: 8px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 12px;
            text-align: center;
            display: none;
            border: 1px solid #b3d7ff;
        }
        
        .update-status.error {
            background: #fff0f0;
            color: #721c24;
            border: 1px solid #ffcccc;
        }
        
        /* åˆ†æ•¸é¡¯ç¤ºå€ */
        .score-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); /* æ”¹ç‚ºä¸­æ€§è‰² */
            color: #333;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid #dee2e6;
        }
        
        .score-value {
            font-size: 48px;
            font-weight: bold;
            margin: 10px 0;
            color: #007bff; /* è—è‰²æ•¸å­— */
        }
        
        .score-percentage {
            font-size: 24px;
            color: #666;
        }
        
        .score-breakdown {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .breakdown-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .breakdown-value {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        
        /* æ§åˆ¶æŒ‰éˆ•çµ„ */
        .control-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .control-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .control-btn.primary {
            background: #007bff;
            color: white;
        }
        
        .control-btn.primary:hover {
            background: #0056b3;
        }
        
        .control-btn.success {
            background: #28a745;
            color: white;
        }
        
        .control-btn.success:hover {
            background: #1e7e34;
        }
        
        .control-btn.warning {
            background: #ffc107;
            color: #212529;
        }
        
        .control-btn.warning:hover {
            background: #e0a800;
        }
        
        .control-btn.danger {
            background: #dc3545;
            color: white;
        }
        
        .control-btn.danger:hover {
            background: #c82333;
        }
        
        /* ä½œç­”ç‹€æ…‹æ¨™ç¤º */
        .answer-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-correct {
            background: #e7f7e7; /* è¼ƒæ·¡çš„ç¶ è‰² */
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-incorrect {
            background: #fdeaea; /* è¼ƒæ·¡çš„ç´…è‰² */
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-unanswered {
            background: #f8f9fa; /* ä¸­æ€§ç°è‰² */
            color: #6c757d;
            border: 1px solid #e9ecef;
        }
        
        /* åˆ†æ•¸è©³ç´°è³‡è¨Š */
        .score-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #dee2e6;
        }
        
        .score-details h4 {
            margin-top: 0;
            color: var(--dark);
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .score-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .score-table th, .score-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
            background: white; /* è¡¨æ ¼ç™½è‰²èƒŒæ™¯ */
        }
        
        .score-table th {
            background: #f1f3f4;
            font-weight: bold;
        }
        
        .score-table tr:hover {
            background: #f5f7f8;
        }
        
        .score-table tr.table-success td {
            background-color: #f0fff0;
        }
        
        .score-table tr.table-danger td {
            background-color: #fff0f0;
        }
        
        .score-table tr.table-secondary td {
            background-color: #f9f9f9;
        }
        
        /* æ–°å¢ï¼šé¡Œç›®å€æ¨£å¼å„ªåŒ– */
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .question-title {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .question-points {
            background: #e9ecef;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: #495057;
        }
        
        /* é¸é …æ¨£å¼å„ªåŒ– */
        .option-circle {
            display: inline-block;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            border-radius: 50%;
            background: #f0f0f0;
            margin-right: 8px;
            font-weight: bold;
        }
        
        /* ä¿®æ­£ï¼šé¸é …å‰çš„åœ“åœˆæ¨£å¼ */
        .options-list label input[type="radio"] {
            margin-right: 10px;
        }
        
        .options-list label {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>

<div class="sidebar">
    <button id="toggleModeBtn" class="btn-mode">ğŸ› ï¸ é€²å…¥ï¼šæ ¡æ­£æ¨¡å¼</button>

    <div class="status-box">
        <span id="timer-display">00:00:00</span>
        <div class="parse-stats" id="parse-stats">ç‹€æ…‹ï¼šç­‰å¾…è¼‰å…¥æª”æ¡ˆ</div>
    </div>

    <!-- æ›´æ–°ç‹€æ…‹æç¤º -->
    <div id="update-status" class="update-status"></div>

    <!-- æª”æ¡ˆç®¡ç† -->
    <div class="file-management">
        <h4 style="margin-top:0;">ğŸ“ æª”æ¡ˆç®¡ç†</h4>
        
        <div class="file-type-group">
            <div class="file-type-btn ans-type active" id="btn-ans-files" onclick="switchFileType('ans')">
                ğŸ“˜ ç­”æ¡ˆå·è¨­å®š
            </div>
            <div class="file-type-btn quiz-type" id="btn-quiz-files" onclick="switchFileType('quiz')">
                ğŸ“‹ å•å·è¨­å®š
            </div>
        </div>
        
        <div style="margin-bottom:15px;">
            <input type="file" id="folderInput" webkitdirectory directory multiple>
            <div id="file-list" style="margin-top:10px; border: 1px solid #ddd; max-height: 120px; overflow-y: auto;"></div>
        </div>
        
        <div class="config-summary" id="config-summary">
            ç•¶å‰è¨­å®šï¼šç­”æ¡ˆå· (Y:8px, X:5px, é é¦–:200å­—, é å°¾:0å­—)
        </div>
    </div>

    <!-- ç­”æ¡ˆå·åˆ‡å‰²åƒæ•¸ -->
    <div class="cut-config-panel ans-config" id="ans-config-panel">
        <h4>
            ğŸ“˜ ç­”æ¡ˆå·åˆ‡å‰²åƒæ•¸
            <span class="config-tag ans-tag">ç­”æ¡ˆå·</span>
        </h4>
        
        <div style="font-size:11px; color:#666; margin-bottom:10px;">
            ç­”æ¡ˆå·é€šå¸¸æœ‰æ˜ç¢ºçš„ã€Œç­”æ¡ˆï¼šAã€æ ¼å¼ï¼Œéœ€è¦ç²¾ç¢ºåˆ‡å‰²
        </div>
        
        <div class="cut-param-group">
            <label>Yåº§æ¨™åˆ‡å‰²é–¾å€¼: <span class="param-value" id="ans_v_y">8</span> px</label>
            <input type="range" id="ans_yThreshold" min="1" max="30" value="8" step="0.5">
            <div style="font-size: 10px; color: #666;">
                <span style="float:left;">å¯¬é¬† (1)</span>
                <span style="float:right;">åš´æ ¼ (30)</span>
                <div style="clear:both;"></div>
            </div>
        </div>
        
        <div class="cut-param-group">
            <label>Xåº§æ¨™åˆ‡å‰²é–¾å€¼: <span class="param-value" id="ans_v_x">5</span> px</label>
            <input type="range" id="ans_xThreshold" min="1" max="20" value="5" step="0.5">
            <div style="font-size: 10px; color: #666;">
                <span style="float:left;">å¯¬é¬† (1)</span>
                <span style="float:right;">åš´æ ¼ (20)</span>
                <div style="clear:both;"></div>
            </div>
        </div>
        
        <div class="cut-param-group">
            <label>é é¦–åˆ‡é™¤å­—æ•¸: <span class="param-value" id="ans_v_th">200</span> å­—</label>
            <input type="range" id="ans_trimHeader" min="0" max="500" value="200">
            <div style="font-size: 10px; color: #666;">
                åˆ‡é™¤é–‹é ­éé¡Œç›®å…§å®¹ï¼ˆå¦‚æ¨™é¡Œã€èªªæ˜ç­‰ï¼‰
            </div>
        </div>
        
        <div class="cut-param-group">
            <label>é å°¾åˆ‡é™¤å­—æ•¸: <span class="param-value" id="ans_v_tf">0</span> å­—</label>
            <input type="range" id="ans_trimFooter" min="0" max="500" value="0">
            <div style="font-size: 10px; color: #666;">
                åˆ‡é™¤çµå°¾éé¡Œç›®å…§å®¹ï¼ˆå¦‚ç‰ˆæ¬Šè²æ˜ã€é ç¢¼ç­‰ï¼‰
            </div>
        </div>
        
        <div class="cut-param-group">
            <label>å­—å…ƒå¯¬åº¦ä¼°ç®—: <span class="param-value" id="ans_v_w">10</span> px</label>
            <input type="range" id="ans_charWidth" min="5" max="20" value="10">
        </div>
        
        <button class="reparse-btn" data-type="ans" style="width:100%; padding:8px; margin-top:5px; background:var(--primary); color:white; border:none; border-radius:4px; cursor:pointer;">
            ğŸ”„ é‡æ–°åˆ‡å‰²ç­”æ¡ˆå·
        </button>
    </div>

    <!-- å•å·åˆ‡å‰²åƒæ•¸ -->
    <div class="cut-config-panel quiz-config" id="quiz-config-panel" style="display:none;">
        <h4>
            ğŸ“‹ å•å·åˆ‡å‰²åƒæ•¸
            <span class="config-tag quiz-tag">å•å·</span>
        </h4>
        
        <div style="font-size:11px; color:#666; margin-bottom:10px;">
            å•å·é€šå¸¸æœ‰é¡Œç›®å’Œé¸é …ï¼Œéœ€è¦ä¸åŒçš„åˆ‡å‰²ç­–ç•¥
        </div>
        
        <div class="cut-param-group">
            <label>Yåº§æ¨™åˆ‡å‰²é–¾å€¼: <span class="param-value" id="quiz_v_y">12</span> px</label>
            <input type="range" id="quiz_yThreshold" min="1" max="30" value="12" step="0.5">
            <div style="font-size: 10px; color: #666;">
                <span style="float:left;">å¯¬é¬† (1)</span>
                <span style="float:right;">åš´æ ¼ (30)</span>
                <div style="clear:both;"></div>
            </div>
        </div>
        
        <div class="cut-param-group">
            <label>Xåº§æ¨™åˆ‡å‰²é–¾å€¼: <span class="param-value" id="quiz_v_x">8</span> px</label>
            <input type="range" id="quiz_xThreshold" min="1" max="20" value="8" step="0.5">
            <div style="font-size: 10px; color: #666;">
                <span style="float:left;">å¯¬é¬† (1)</span>
                <span style="float:right;">åš´æ ¼ (20)</span>
                <div style="clear:both;"></div>
            </div>
        </div>
        
        <div class="cut-param-group">
            <label>é é¦–åˆ‡é™¤å­—æ•¸: <span class="param-value" id="quiz_v_th">300</span> å­—</label>
            <input type="range" id="quiz_trimHeader" min="0" max="500" value="300">
            <div style="font-size: 10px; color: #666;">
                åˆ‡é™¤é–‹é ­éé¡Œç›®å…§å®¹ï¼ˆå¦‚æ¨™é¡Œã€èªªæ˜ç­‰ï¼‰
            </div>
        </div>
        
        <div class="cut-param-group">
            <label>é å°¾åˆ‡é™¤å­—æ•¸: <span class="param-value" id="quiz_v_tf">0</span> å­—</label>
            <input type="range" id="quiz_trimFooter" min="0" max="500" value="0">
            <div style="font-size: 10px; color: #666;">
                åˆ‡é™¤çµå°¾éé¡Œç›®å…§å®¹ï¼ˆå¦‚ç‰ˆæ¬Šè²æ˜ã€é ç¢¼ç­‰ï¼‰
            </div>
        </div>
        
        <div class="cut-param-group">
            <label>é¸é …é–“è·è£œå„Ÿ: <span class="param-value" id="quiz_v_s">15</span> px</label>
            <input type="range" id="quiz_optionSpacing" min="5" max="30" value="15">
        </div>
        
        <button class="reparse-btn" data-type="quiz" style="width:100%; padding:8px; margin-top:5px; background:var(--warning); color:white; border:none; border-radius:4px; cursor:pointer;">
            ğŸ”„ é‡æ–°åˆ‡å‰²å•å·
        </button>
    </div>
    
    <!-- PDFæ–‡å­—é è¦½ -->
    <div class="preview-panel">
        <h5 id="preview-title">ğŸ“„ ç­”æ¡ˆå·è§£ææ–‡å­—é è¦½ï¼ˆå‰300å­—ï¼‰</h5>
        <div class="preview-text" id="pdfPreview"></div>
        <div style="margin-top: 10px; font-size: 11px; color: #666; display: flex; justify-content: space-between;">
            <span id="trim-info-header">é é¦–åˆ‡é™¤: 0å­—</span>
            <span id="trim-info-footer">é å°¾åˆ‡é™¤: 0å­—</span>
        </div>
    </div>
    
    <!-- ç­”æ¡ˆå°ç…§è¡¨ -->
    <div id="adjustment-zone" style="display:none;">
        <div class="ans-panel">
            <strong>ğŸ¯ ç­”æ¡ˆå°ç…§è¡¨ (å…± <span id="ans-count">0</span> å€‹ç­”æ¡ˆ)</strong>
            <div class="ans-grid" id="visualAnsGrid"></div>
        </div>
        
        <div class="export-buttons">
            <button onclick="exportToCSV()" style="background:#27ae60; color:white;">ğŸ“¥ åŒ¯å‡ºç­”æ¡ˆ</button>
            <button onclick="clearRecords()" style="background:#dc3545; color:white;">ğŸ—‘ï¸ æ¸…ç©ºç´€éŒ„</button>
        </div>
    </div>
</div>

<div class="main-content">
    <h2 id="current-title" style="margin-top:0;">è«‹å¾å·¦å´é¸å–è€ƒå·</h2>
    <hr>
    
    <!-- æ§åˆ¶æŒ‰éˆ•çµ„ -->
    <div class="control-buttons" id="control-buttons" style="display:none;">
        <button class="control-btn primary" onclick="submitAllAnswers()">ğŸ“¤ é€å‡ºç­”æ¡ˆ</button>
        <button class="control-btn success" onclick="checkAllAnswers()">âœ… å°ç­”æ¡ˆ</button>
        <button class="control-btn warning" onclick="calculateScore()">ğŸ“Š è¨ˆç®—åˆ†æ•¸</button>
        <button class="control-btn danger" onclick="resetAllAnswers()">ğŸ”„ é‡è¨­ä½œç­”</button>
    </div>
    
    <!-- åˆ†æ•¸é¡¯ç¤ºå€ -->
    <div id="score-box" class="score-box" style="display:none;">
        <h3>æ¸¬é©—æˆç¸¾</h3>
        <div class="score-value" id="total-score">0</div>
        <div class="score-percentage" id="score-percentage">0%</div>
        <div class="score-breakdown">
            <div class="breakdown-item">
                <span>æ­£ç¢º</span>
                <div class="breakdown-value" id="correct-count">0</div>
            </div>
            <div class="breakdown-item">
                <span>éŒ¯èª¤</span>
                <div class="breakdown-value" id="incorrect-count">0</div>
            </div>
            <div class="breakdown-item">
                <span>æœªç­”</span>
                <div class="breakdown-value" id="unanswered-count">0</div>
            </div>
            <div class="breakdown-item">
                <span>æ­£ç¢ºç‡</span>
                <div class="breakdown-value" id="accuracy-rate">0%</div>
            </div>
        </div>
    </div>
    
    <div id="cut-analysis" style="margin-bottom:20px;"></div>
    
    <div id="quiz-box"></div>
    
    <!-- åˆ†æ•¸è©³ç´°è³‡è¨Š -->
    <div id="score-details" class="score-details" style="display:none;">
        <h4>ğŸ“‹ ç­”é¡Œè©³ç´°å ±å‘Š</h4>
        <table class="score-table" id="score-table">
            <thead>
                <tr>
                    <th>é¡Œè™Ÿ</th>
                    <th>æ­£ç¢ºç­”æ¡ˆ</th>
                    <th>æ‚¨çš„ç­”æ¡ˆ</th>
                    <th>ç‹€æ…‹</th>
                    <th>å¾—åˆ†</th>
                </tr>
            </thead>
            <tbody id="score-table-body">
                <!-- å‹•æ…‹ç”Ÿæˆ -->
            </tbody>
        </table>
    </div>
</div>

<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    let isEditMode = false;
    let examPool = {};
    let rawExamText = "";
    let rawQuizText = "";
    let lastAnsRawText = "";
    let pdfPreviewText = "";
    let fullAnsSequence = []; 
    let finalData = [];
    let startTime, timerInterval;
    let currentFileType = 'ans'; // 'ans' æˆ– 'quiz'
    let userAnswers = {}; // å„²å­˜ä½¿ç”¨è€…ç­”æ¡ˆ
    let examResults = []; // å„²å­˜è€ƒè©¦çµæœ
    
    // ç¨ç«‹åˆ‡å‰²åƒæ•¸è¨­å®š
    const cutParams = {
        ans: {
            yThreshold: 8,
            xThreshold: 5,
            trimHeader: 200,
            trimFooter: 0,
            charWidth: 10
        },
        quiz: {
            yThreshold: 12,
            xThreshold: 8,
            trimHeader: 300,
            trimFooter: 0,
            optionSpacing: 15
        }
    };

    // åˆ‡æ›æª”æ¡ˆé¡å‹
    function switchFileType(type) {
        currentFileType = type;
        
        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        document.getElementById('btn-ans-files').classList.toggle('active', type === 'ans');
        document.getElementById('btn-quiz-files').classList.toggle('active', type === 'quiz');
        
        // é¡¯ç¤ºå°æ‡‰çš„è¨­å®šé¢æ¿
        document.getElementById('ans-config-panel').style.display = type === 'ans' ? 'block' : 'none';
        document.getElementById('quiz-config-panel').style.display = type === 'quiz' ? 'block' : 'none';
        
        // æ›´æ–°é è¦½æ¨™é¡Œ
        document.getElementById('preview-title').textContent = 
            type === 'ans' ? 'ğŸ“„ ç­”æ¡ˆå·è§£ææ–‡å­—é è¦½ï¼ˆå‰300å­—ï¼‰' : 'ğŸ“„ å•å·è§£ææ–‡å­—é è¦½ï¼ˆå‰300å­—ï¼‰';
        
        // æ›´æ–°è¨­å®šæ‘˜è¦
        updateConfigSummary();
        
        // æ›´æ–°åˆ‡é™¤è³‡è¨Šé¡¯ç¤º
        updateTrimInfoDisplay();
        
        // é¡¯ç¤ºå°æ‡‰çš„é è¦½
        showPdfPreview(type);
    }

    // æ›´æ–°è¨­å®šæ‘˜è¦
    function updateConfigSummary() {
        const summary = document.getElementById('config-summary');
        const params = cutParams[currentFileType];
        
        if (currentFileType === 'ans') {
            summary.innerHTML = `
                ç•¶å‰è¨­å®šï¼š<strong>ç­”æ¡ˆå·</strong><br>
                Yé–¾å€¼: ${params.yThreshold}px | Xé–¾å€¼: ${params.xThreshold}px<br>
                é é¦–: ${params.trimHeader}å­— | é å°¾: ${params.trimFooter}å­— | å­—å¯¬: ${params.charWidth}px
            `;
        } else {
            summary.innerHTML = `
                ç•¶å‰è¨­å®šï¼š<strong>å•å·</strong><br>
                Yé–¾å€¼: ${params.yThreshold}px | Xé–¾å€¼: ${params.xThreshold}px<br>
                é é¦–: ${params.trimHeader}å­— | é å°¾: ${params.trimFooter}å­— | é¸é …é–“è·: ${params.optionSpacing}px
            `;
        }
    }

    // æ›´æ–°åˆ‡é™¤è³‡è¨Šé¡¯ç¤º
    function updateTrimInfoDisplay() {
        const params = cutParams[currentFileType];
        const headerInfo = document.getElementById('trim-info-header');
        const footerInfo = document.getElementById('trim-info-footer');
        
        if (headerInfo) {
            headerInfo.textContent = `é é¦–åˆ‡é™¤: ${params.trimHeader}å­—`;
        }
        if (footerInfo) {
            footerInfo.textContent = `é å°¾åˆ‡é™¤: ${params.trimFooter}å­—`;
        }
    }

    // é¡¯ç¤ºæ›´æ–°ç‹€æ…‹
    function showUpdateStatus(message, isError = false) {
        const statusDiv = document.getElementById('update-status');
        if (!statusDiv) return;
        
        statusDiv.textContent = message;
        statusDiv.className = `update-status ${isError ? 'error' : ''}`;
        statusDiv.style.display = 'block';
        
        // 3ç§’å¾Œè‡ªå‹•éš±è—
        setTimeout(() => {
            statusDiv.style.display = 'none';
        }, 3000);
    }

    // åˆå§‹åŒ–æ§åˆ¶é …
    function initCutControls() {
        // ç­”æ¡ˆå·æ§åˆ¶é …
        document.getElementById('ans_yThreshold').value = cutParams.ans.yThreshold;
        document.getElementById('ans_xThreshold').value = cutParams.ans.xThreshold;
        document.getElementById('ans_trimHeader').value = cutParams.ans.trimHeader;
        document.getElementById('ans_trimFooter').value = cutParams.ans.trimFooter;
        document.getElementById('ans_charWidth').value = cutParams.ans.charWidth;
        
        // å•å·æ§åˆ¶é …
        document.getElementById('quiz_yThreshold').value = cutParams.quiz.yThreshold;
        document.getElementById('quiz_xThreshold').value = cutParams.quiz.xThreshold;
        document.getElementById('quiz_trimHeader').value = cutParams.quiz.trimHeader;
        document.getElementById('quiz_trimFooter').value = cutParams.quiz.trimFooter;
        document.getElementById('quiz_optionSpacing').value = cutParams.quiz.optionSpacing;
        
        // æ›´æ–°é¡¯ç¤ºå€¼
        updateParamDisplay('ans');
        updateParamDisplay('quiz');
        
        // ç¶å®šäº‹ä»¶
        bindCutControlEvents();
    }

    // ç¶å®šåˆ‡å‰²æ§åˆ¶é …äº‹ä»¶
    function bindCutControlEvents() {
        // ç­”æ¡ˆå·æ§åˆ¶é …
        document.getElementById('ans_yThreshold').oninput = function() { 
            cutParams.ans.yThreshold = parseFloat(this.value);
            document.getElementById('ans_v_y').innerText = cutParams.ans.yThreshold.toFixed(1);
            updateConfigSummary();
        };
        
        document.getElementById('ans_xThreshold').oninput = function() { 
            cutParams.ans.xThreshold = parseFloat(this.value);
            document.getElementById('ans_v_x').innerText = cutParams.ans.xThreshold.toFixed(1);
            updateConfigSummary();
        };
        
        document.getElementById('ans_trimHeader').oninput = function() { 
            cutParams.ans.trimHeader = parseInt(this.value);
            document.getElementById('ans_v_th').innerText = cutParams.ans.trimHeader;
            updateConfigSummary();
            updateTrimInfoDisplay();
        };
        
        document.getElementById('ans_trimFooter').oninput = function() { 
            cutParams.ans.trimFooter = parseInt(this.value);
            document.getElementById('ans_v_tf').innerText = cutParams.ans.trimFooter;
            updateConfigSummary();
            updateTrimInfoDisplay();
        };
        
        document.getElementById('ans_charWidth').oninput = function() { 
            cutParams.ans.charWidth = parseInt(this.value);
            document.getElementById('ans_v_w').innerText = cutParams.ans.charWidth;
            updateConfigSummary();
        };
        
        // å•å·æ§åˆ¶é …
        document.getElementById('quiz_yThreshold').oninput = function() { 
            cutParams.quiz.yThreshold = parseFloat(this.value);
            document.getElementById('quiz_v_y').innerText = cutParams.quiz.yThreshold.toFixed(1);
            updateConfigSummary();
        };
        
        document.getElementById('quiz_xThreshold').oninput = function() { 
            cutParams.quiz.xThreshold = parseFloat(this.value);
            document.getElementById('quiz_v_x').innerText = cutParams.quiz.xThreshold.toFixed(1);
            updateConfigSummary();
        };
        
        document.getElementById('quiz_trimHeader').oninput = function() { 
            cutParams.quiz.trimHeader = parseInt(this.value);
            document.getElementById('quiz_v_th').innerText = cutParams.quiz.trimHeader;
            updateConfigSummary();
            updateTrimInfoDisplay();
        };
        
        document.getElementById('quiz_trimFooter').oninput = function() { 
            cutParams.quiz.trimFooter = parseInt(this.value);
            document.getElementById('quiz_v_tf').innerText = cutParams.quiz.trimFooter;
            updateConfigSummary();
            updateTrimInfoDisplay();
        };
        
        document.getElementById('quiz_optionSpacing').oninput = function() { 
            cutParams.quiz.optionSpacing = parseInt(this.value);
            document.getElementById('quiz_v_s').innerText = cutParams.quiz.optionSpacing;
            updateConfigSummary();
        };
        
        // é‡æ–°åˆ‡å‰²æŒ‰éˆ•
        document.querySelectorAll('.reparse-btn').forEach(btn => {
            btn.onclick = async function() {
                const type = this.getAttribute('data-type');
                await reparseCurrentFile(type);
            };
        });
    }

    // æ›´æ–°åƒæ•¸é¡¯ç¤º
    function updateParamDisplay(type) {
        const params = cutParams[type];
        
        if (type === 'ans') {
            document.getElementById('ans_v_y').innerText = params.yThreshold.toFixed(1);
            document.getElementById('ans_v_x').innerText = params.xThreshold.toFixed(1);
            document.getElementById('ans_v_th').innerText = params.trimHeader;
            document.getElementById('ans_v_tf').innerText = params.trimFooter;
            document.getElementById('ans_v_w').innerText = params.charWidth;
        } else {
            document.getElementById('quiz_v_y').innerText = params.yThreshold.toFixed(1);
            document.getElementById('quiz_v_x').innerText = params.xThreshold.toFixed(1);
            document.getElementById('quiz_v_th').innerText = params.trimHeader;
            document.getElementById('quiz_v_tf').innerText = params.trimFooter;
            document.getElementById('quiz_v_s').innerText = params.optionSpacing;
        }
    }

    // é‡æ–°åˆ‡å‰²ç•¶å‰æª”æ¡ˆ
    async function reparseCurrentFile(type) {
        const activeItem = document.querySelector('.file-item.active');
        if (!activeItem) {
            showUpdateStatus('è«‹å…ˆé¸æ“‡ä¸€å€‹æª”æ¡ˆï¼', true);
            return;
        }
        
        const activeTitle = activeItem.textContent.replace('ğŸ“„ ', '');
        let foundFile = null;
        
        // å°‹æ‰¾å°æ‡‰çš„æª”æ¡ˆ
        for (let key in examPool) {
            if (examPool[key].title === activeTitle) {
                foundFile = examPool[key];
                break;
            }
        }
        
        if (!foundFile) {
            showUpdateStatus('æ‰¾ä¸åˆ°å°æ‡‰çš„æª”æ¡ˆï¼', true);
            return;
        }
        
        try {
            showUpdateStatus(`æ­£åœ¨é‡æ–°åˆ‡å‰²${type === 'ans' ? 'ç­”æ¡ˆå·' : 'å•å·'}...`);
            
            let newText = "";
            if (type === 'ans' && foundFile.ans) {
                console.log(`é‡æ–°åˆ‡å‰²ç­”æ¡ˆå·ï¼Œä½¿ç”¨åƒæ•¸:`, cutParams.ans);
                newText = await getPdfTextWithCutParams(foundFile.ans, 'ans');
                lastAnsRawText = newText;
                
                // é‡æ–°æå–ç­”æ¡ˆ
                const result = extractAnswersWithCutAnalysis('ans');
                
                // æ›´æ–°é è¦½
                showPdfPreview('ans');
                
                // æ›´æ–°ç­”æ¡ˆç¶²æ ¼
                updateVisualGrid();
                
                // é¡¯ç¤ºåˆ‡å‰²åˆ†æ
                showCutAnalysis();
                
                // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
                const multiLetterCount = fullAnsSequence.filter(a => a && a.length > 1).length;
                document.getElementById('ans-count').textContent = fullAnsSequence.filter(a => a && a !== "").length;
                
                showUpdateStatus(`âœ… ç­”æ¡ˆå·é‡æ–°åˆ‡å‰²å®Œæˆï¼æ‰¾åˆ° ${fullAnsSequence.filter(a => a).length} å€‹ç­”æ¡ˆï¼Œ${multiLetterCount} å€‹å¤šå­—æ¯ç­”æ¡ˆ`);
                
            } else if (type === 'quiz' && foundFile.exam) {
                console.log(`é‡æ–°åˆ‡å‰²å•å·ï¼Œä½¿ç”¨åƒæ•¸:`, cutParams.quiz);
                newText = await getPdfTextWithCutParams(foundFile.exam, 'quiz');
                rawExamText = newText;
                
                // æ›´æ–°é è¦½
                showPdfPreview('quiz');
                
                // é‡æ–°è§£æå•å·
                runParser();
                
                showUpdateStatus(`âœ… å•å·é‡æ–°åˆ‡å‰²å®Œæˆï¼è§£æå‡º ${finalData.length} å€‹é¡Œç›®`);
            } else {
                showUpdateStatus('æ‰¾ä¸åˆ°å°æ‡‰çš„æª”æ¡ˆé¡å‹ï¼', true);
                return;
            }
            
            // æ›´æ–°çµ±è¨ˆè³‡è¨Š
            updateStats();
            
        } catch (error) {
            console.error('é‡æ–°åˆ‡å‰²æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            showUpdateStatus(`âŒ é‡æ–°åˆ‡å‰²å¤±æ•—: ${error.message}`, true);
        }
    }

    // æ›´æ–°çµ±è¨ˆè³‡è¨Š
    function updateStats() {
        const parseStats = document.getElementById('parse-stats');
        if (!parseStats) return;
        
        const multiLetterCount = fullAnsSequence.filter(a => a && a.length > 1).length;
        const debugInfo = `
            é¡Œç›®ç¸½æ•¸ï¼š${finalData.length}<br>
            ç­”æ¡ˆæ•¸ï¼š${fullAnsSequence.filter(a => a).length}/50<br>
            å¤šå­—æ¯ç­”æ¡ˆï¼š${multiLetterCount} å€‹ï¼ˆå¯èƒ½åˆ‡å‰²éŒ¯èª¤ï¼‰<br>
            ç•¶å‰æ¨¡å¼ï¼š${currentFileType === 'ans' ? 'ç­”æ¡ˆå·' : 'å•å·'}
        `;
        
        parseStats.innerHTML = `é¡Œç›®ï¼š${finalData.length} / ç­”æ¡ˆï¼š${fullAnsSequence.filter(a => a).length} <div class="debug-info">${debugInfo}</div>`;
    }

    // æ¨¡å¼åˆ‡æ›
    document.getElementById('toggleModeBtn').onclick = () => { 
        isEditMode = !isEditMode; 
        updateModeUI(); 
    };

    function updateModeUI() {
        const zone = document.getElementById('adjustment-zone');
        const btn = document.getElementById('toggleModeBtn');
        zone.style.display = isEditMode ? "block" : "none";
        btn.innerText = isEditMode ? "âœï¸ è¿”å›ï¼šä½œç­”æ¨¡å¼" : "ğŸ› ï¸ é€²å…¥ï¼šæ ¡æ­£æ¨¡å¼";
        btn.style.background = isEditMode ? "var(--warning)" : "var(--dark)";
    }

    // åˆå§‹åŒ–ç­”æ¡ˆç¶²æ ¼
    function initGrid() {
        const grid = document.getElementById('visualAnsGrid');
        if (!grid) return;
        
        grid.innerHTML = "";
        for (let i = 1; i <= 50; i++) {
            grid.innerHTML += `<div class="ans-unit" id="unit-${i}"><span>${i}</span><input type="text" id="ansInp-${i}"></div>`;
        }
    }

    // æ›´æ–°è¦–è¦ºåŒ–ç¶²æ ¼
    function updateVisualGrid() {
        try {
            for (let i = 1; i <= 50; i++) {
                const input = document.getElementById(`ansInp-${i}`);
                const unit = document.getElementById(`unit-${i}`);
                if (!input) continue;
                
                let val = "";
                const seqIdx = i - 1;

                if (seqIdx >= 0 && seqIdx < fullAnsSequence.length) {
                    val = fullAnsSequence[seqIdx] || "";
                }

                input.value = val;
                
                // æ›´æ–°æ ¼å­æ¨£å¼
                if (unit) {
                    unit.classList.remove('multi-letter', 'cut-problem');
                    
                    // æ¨™è¨˜åˆ‡å‰²å•é¡Œ
                    if (val && val.length > 1 && /^[A-E]+$/i.test(val)) {
                        unit.classList.add('multi-letter');
                        unit.classList.add('cut-problem');
                        unit.title = `åˆ‡å‰²å•é¡Œï¼šå¤šå­—æ¯ç­”æ¡ˆ "${val}"`;
                    }
                }
            }
            
            // æ›´æ–°ç­”æ¡ˆæ•¸é‡é¡¯ç¤º
            const ansCount = document.getElementById('ans-count');
            if (ansCount) {
                ansCount.textContent = fullAnsSequence.filter(a => a && a !== "").length;
            }
        } catch (error) {
            console.error('æ›´æ–°è¦–è¦ºåŒ–æ ¼å­æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
        }
    }

    // æ”¹é€²çš„PDFæ–‡å­—æå–å‡½æ•¸ï¼Œæ”¯æ´ç¨ç«‹åƒæ•¸
    async function getPdfTextWithCutParams(file, type = 'ans') {
        const params = cutParams[type];
        const doc = await pdfjsLib.getDocument(await file.arrayBuffer()).promise;
        let text = "";
        
        for (let i = 1; i <= doc.numPages; i++) {
            const page = await doc.getPage(i);
            const content = await page.getTextContent();
            const items = content.items;
            
            // æŒ‰Yåº§æ¨™æ’åº
            items.sort((a, b) => {
                if (Math.abs(a.transform[5] - b.transform[5]) > params.yThreshold) {
                    return b.transform[5] - a.transform[5];
                } else {
                    return a.transform[4] - b.transform[4];
                }
            });
            
            // åˆ†çµ„æˆè¡Œ
            const lines = [];
            let currentLine = [];
            let lastY = null;
            
            for (let item of items) {
                if (lastY === null) {
                    currentLine.push(item);
                } else if (Math.abs(lastY - item.transform[5]) <= params.yThreshold) {
                    currentLine.push(item);
                } else {
                    lines.push(currentLine);
                    currentLine = [item];
                }
                lastY = item.transform[5];
            }
            if (currentLine.length > 0) {
                lines.push(currentLine);
            }
            
            // è™•ç†æ¯ä¸€è¡Œ
            for (let line of lines) {
                line.sort((a, b) => a.transform[4] - b.transform[4]);
                let lineText = "";
                let lastX = null;
                
                for (let item of line) {
                    if (lastX !== null) {
                        const xGap = item.transform[4] - lastX;
                        let charWidthEstimate = params.charWidth || 10;
                        
                        if (type === 'quiz') {
                            // å•å·ä½¿ç”¨é¸é …é–“è·
                            charWidthEstimate = params.optionSpacing || 15;
                        }
                        
                        if (xGap > charWidthEstimate) {
                            const spaces = Math.floor(xGap / charWidthEstimate);
                            lineText += " ".repeat(Math.max(1, Math.min(3, spaces)));
                        }
                    }
                    
                    lineText += item.str;
                    lastX = item.transform[4] + (item.width || 0);
                }
                
                text += lineText + "\n";
            }
        }
        
        // ç‰¹æ®Šå­—å…ƒæ›¿æ›
        text = text.replace(/î†Œ/g,"(A)")
                   .replace(/î†/g,"(B)")
                   .replace(/î†/g,"(C)")
                   .replace(/î†/g,"(D)")
                   .replace(/î†/g,"(E)");
        
        // æ‡‰ç”¨é é¦–åˆ‡é™¤
        if (params.trimHeader > 0 && text.length > params.trimHeader) {
            text = text.substring(params.trimHeader);
        }
        
        // æ‡‰ç”¨é å°¾åˆ‡é™¤
        if (params.trimFooter > 0 && text.length > params.trimFooter) {
            text = text.substring(0, text.length - params.trimFooter);
        }
        
        return text;
    }

    // é¡¯ç¤ºPDFé è¦½
    function showPdfPreview(type = 'ans') {
        const previewBox = document.getElementById('pdfPreview');
        if (!previewBox) return;
        
        let textToPreview = "";
        if (type === 'ans' && lastAnsRawText) {
            textToPreview = lastAnsRawText;
        } else if (type === 'quiz' && rawExamText) {
            textToPreview = rawExamText;
        } else {
            previewBox.innerHTML = "<div style='color:#666; font-style:italic;'>å°šæœªè¼‰å…¥æª”æ¡ˆ</div>";
            return;
        }
        
        // å–å‰300å­—é¡¯ç¤º
        pdfPreviewText = textToPreview.substring(0, 300);
        let previewHTML = "";
        
        const lines = pdfPreviewText.split('\n');
        for (let i = 0; i < Math.min(20, lines.length); i++) {
            let line = lines[i];
            const isAnswerLine = line.includes('ç­”æ¡ˆ') || /\b[A-E]{1,2}\b/.test(line);
            previewHTML += `<div class="preview-line ${isAnswerLine ? 'highlight' : ''}">${escapeHtml(line)}</div>`;
        }
        
        if (lines.length > 20) {
            previewHTML += `<div style="color:#666; font-style:italic;">...ï¼ˆé‚„æœ‰ ${lines.length - 20} è¡Œï¼‰</div>`;
        }
        
        previewBox.innerHTML = previewHTML;
    }

    // æª”æ¡ˆé¸æ“‡è™•ç†
    document.getElementById('folderInput').onchange = function(e) {
        const files = Array.from(e.target.files).filter(f => f.name.toLowerCase().endsWith('.pdf'));
        const pairs = {};
        
        files.forEach(f => {
            const name = f.name;
            const year = name.substring(0, 6);
            const isMod = name.includes('_MOD');
            const isAns = name.includes('_ANS') && !isMod;
            const subject = name.split('_').pop().replace('.pdf', '');
            const key = year + subject;
            
            if (!pairs[key]) {
                pairs[key] = { 
                    title: `${year} ${subject}`, 
                    exam: null, 
                    ans: null, 
                    type: null 
                };
            }
            
            if (!isMod && !isAns) {
                pairs[key].exam = f;
            } else if (isMod) { 
                pairs[key].ans = f; 
                pairs[key].type = 'MOD'; 
            } else if (isAns && pairs[key].type !== 'MOD') { 
                pairs[key].ans = f; 
                pairs[key].type = 'ANS'; 
            }
        });
        
        const listDiv = document.getElementById('file-list');
        listDiv.innerHTML = ""; 
        examPool = pairs;
        
        for (let k in pairs) {
            if (pairs[k].exam && pairs[k].ans) {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerText = `ğŸ“„ ${pairs[k].title}`;
                item.onclick = async () => {
                    document.querySelectorAll('.file-item').forEach(el => el.classList.remove('active'));
                    item.classList.add('active');
                    await loadExam(k);
                };
                listDiv.appendChild(item);
            }
        }
        
        if (Object.keys(pairs).length > 0) {
            updateConfigSummary();
        }
    };

    // è¼‰å…¥è€ƒå·
    async function loadExam(key) {
        try {
            const pair = examPool[key];
            if (!pair) return;
            
            document.getElementById('current-title').innerText = pair.title;
            showUpdateStatus('æ­£åœ¨è¼‰å…¥è€ƒå·...');
            
            // ä½¿ç”¨å„è‡ªçš„åƒæ•¸è¼‰å…¥ç­”æ¡ˆå·å’Œå•å·
            if (pair.exam) {
                rawExamText = await getPdfTextWithCutParams(pair.exam, 'quiz');
            }
            
            if (pair.ans) {
                lastAnsRawText = await getPdfTextWithCutParams(pair.ans, 'ans');
            }
            
            // é¡¯ç¤ºé è¦½
            showPdfPreview(currentFileType);
            
            // æå–ç­”æ¡ˆ
            extractAnswersWithCutAnalysis('ans');
            
            // åˆå§‹åŒ–æ ¼å­
            initGrid();
            updateVisualGrid();
            
            if (pair.exam) {
                runParser();
            }
            
            startTimer();
            
            // é¡¯ç¤ºåˆ‡å‰²åˆ†æ
            showCutAnalysis();
            
            // é¡¯ç¤ºæ§åˆ¶æŒ‰éˆ•çµ„
            document.getElementById('control-buttons').style.display = 'flex';
            
            showUpdateStatus('âœ… è€ƒå·è¼‰å…¥å®Œæˆï¼');
            
        } catch (error) {
            console.error('è¼‰å…¥è€ƒå·æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            showUpdateStatus(`âŒ è¼‰å…¥å¤±æ•—: ${error.message}`, true);
        }
    }

    // æå–ç­”æ¡ˆä¸¦åˆ†æåˆ‡å‰²å•é¡Œ
    function extractAnswersWithCutAnalysis(type = 'ans') {
        fullAnsSequence = new Array(50).fill("");
        
        if (!lastAnsRawText) return;
        
        console.log(`${type === 'ans' ? 'ç­”æ¡ˆå·' : 'å•å·'}è§£ææ–‡å­—ï¼ˆå‰500å­—ï¼‰:`, lastAnsRawText.substring(0, 500));
        
        // åˆ†ææ–‡å­—çµæ§‹
        const lines = lastAnsRawText.split('\n');
        let answerLines = [];
        let problemLines = [];
        
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            
            if (line.includes('ç­”æ¡ˆ') || /\d+\s+[A-E]{1,2}/.test(line)) {
                answerLines.push({
                    line: line,
                    index: i,
                    hasMultiLetter: /[A-E]{2,}/.test(line),
                    isProblem: /[A-E]{2,}/.test(line) && !line.includes('ç­”æ¡ˆ')
                });
                
                if (/[A-E]{2,}/.test(line) && !line.includes('ç­”æ¡ˆ')) {
                    problemLines.push({
                        line: line,
                        index: i,
                        problem: "å¯èƒ½èª¤åˆ¤çš„è¤‡é¸ç­”æ¡ˆ"
                    });
                }
            }
        }
        
        // æå–ç­”æ¡ˆ
        const answerRegex = /[A-E#]{1,2}/g;
        const allAnswers = lastAnsRawText.match(answerRegex);
        
        if (allAnswers) {
            console.log("æ‰¾åˆ°çš„ç­”æ¡ˆ:", allAnswers);
            
            for (let i = 0; i < Math.min(50, allAnswers.length); i++) {
                fullAnsSequence[i] = allAnswers[i].toUpperCase();
            }
        }
        
        // æ›´æ–°ç­”æ¡ˆæ•¸é‡é¡¯ç¤º
        const ansCount = document.getElementById('ans-count');
        if (ansCount) {
            ansCount.textContent = fullAnsSequence.filter(a => a && a !== "").length;
        }
        
        return { answerLines, problemLines };
    }

    // é¡¯ç¤ºåˆ‡å‰²åˆ†æ
    function showCutAnalysis() {
        const analysisBox = document.getElementById('cut-analysis');
        if (!analysisBox) return;
        
        const { answerLines, problemLines } = extractAnswersWithCutAnalysis('ans');
        
        let analysisHTML = '<h4>âœ‚ï¸ PDFåˆ‡å‰²åˆ†æå ±å‘Š</h4>';
        
        if (problemLines.length > 0) {
            analysisHTML += `<div style="color:#666; margin-bottom:10px; padding:10px; background:#f8f9fa; border-radius:5px;">
                <strong>âš ï¸ æª¢æ¸¬åˆ° ${problemLines.length} å€‹å¯èƒ½èª¤åˆ¤çš„è¡Œï¼š</strong>
                <div style="font-size:12px; margin-top:5px;">
                    ${problemLines.map(p => `è¡Œ${p.index+1}: "${escapeHtml(p.line.substring(0,50))}..."`).join('<br>')}
                </div>
            </div>`;
        } else {
            analysisHTML += `<div style="color:#666; margin-bottom:10px; padding:10px; background:#f8f9fa; border-radius:5px;">
                <strong>âœ“ PDFåˆ‡å‰²æ­£å¸¸ï¼Œæœªæª¢æ¸¬åˆ°æ˜é¡¯å•é¡Œ</strong>
            </div>`;
        }
        
        // é¡¯ç¤ºç•¶å‰åƒæ•¸
        const currentParams = cutParams[currentFileType];
        analysisHTML += `<div style="margin-top:15px; padding:10px; background:#f8f9fa; border-radius:5px;">
            <strong>ç•¶å‰${currentFileType === 'ans' ? 'ç­”æ¡ˆå·' : 'å•å·'}åˆ‡å‰²åƒæ•¸ï¼š</strong><br>
            â€¢ Yåº§æ¨™é–¾å€¼: ${currentParams.yThreshold}px<br>
            â€¢ Xåº§æ¨™é–¾å€¼: ${currentParams.xThreshold}px<br>
            â€¢ é é¦–åˆ‡é™¤: ${currentParams.trimHeader}å­—<br>
            â€¢ é å°¾åˆ‡é™¤: ${currentParams.trimFooter}å­—<br>
            ${currentFileType === 'ans' ? `â€¢ å­—å…ƒå¯¬åº¦: ${currentParams.charWidth}px` : `â€¢ é¸é …é–“è·: ${currentParams.optionSpacing}px`}
            <br><br>
            <strong>èª¿æ•´å»ºè­°ï¼š</strong><br>
            1. å¦‚æœå‡ºç¾"AA"ã€"CD"ç­‰èª¤åˆ¤ï¼Œå¢åŠ Yé–¾å€¼<br>
            2. å¦‚æœç­”æ¡ˆåˆ†æ•£åœ¨ä¸åŒè¡Œï¼Œæ¸›å°‘Yé–¾å€¼<br>
            3. èª¿æ•´å¾Œé»æ“Š"é‡æ–°åˆ‡å‰²"æŒ‰éˆ•
        </div>`;
        
        analysisBox.innerHTML = analysisHTML;
    }

    // è§£æå•å·
    function runParser() {
        if(!rawExamText) return;
        
        let txt = rawExamText;
        
        const qRegex = /(?:^|\n)\s*(\d{1,2})\s+([\s\S]*?)(?=(?:\n\s*)\d{1,2}\s+|$)/g;
        finalData = []; 
        let m;
        
        while ((m = qRegex.exec(txt)) !== null) {
            const id = parseInt(m[1]);
            const block = m[2];
            
            const optRegex = /\(([A-E])\)\s*([\s\S]*?)(?=\s*\([A-E]\)|$)/g;
            const opts = []; 
            let o;
            
            while((o = optRegex.exec(block)) !== null) {
                opts.push({ 
                    label: o[1], 
                    text: o[2].trim().replace(/\n/g,"") 
                });
            }
            
            if(opts.length >= 4) {
                const answerInput = document.getElementById(`ansInp-${id}`);
                let correctAnswer = answerInput ? answerInput.value : "";
                
                finalData.push({ 
                    id, 
                    content: block.split("(A)")[0].trim().replace(/\n/g,""), 
                    options: opts, 
                    correct: correctAnswer,
                    singlePoints: 2
                });
            }
        }
        
        // æ›´æ–°çµ±è¨ˆ
        updateStats();
        
        // æ¸²æŸ“UI
        renderUI();
    }

    // æ¸²æŸ“UI - ç§»é™¤æ‰€æœ‰é è¨­ç¶ è‰²åº•è‰²
    function renderUI() {
        const quizBox = document.getElementById("quiz-box");
        if (!quizBox) return;
        
        quizBox.innerHTML = finalData.map(q => {
            // ç²å–ä½¿ç”¨è€…å…ˆå‰é¸æ“‡çš„ç­”æ¡ˆ
            const userAnswer = userAnswers[q.id] || '';
            
            // ç”Ÿæˆé¸é …HTML - ç§»é™¤æ‰€æœ‰é è¨­é¡è‰²
            const optionsHTML = q.options.map(o => {
                const isSelected = userAnswer === o.label;
                const isCorrect = q.correct === o.label;
                let className = '';
                
                // åªåœ¨å°ç­”æ¡ˆå¾Œæ‰æ·»åŠ é¡è‰²é¡åˆ¥
                if (isSelected) {
                    className = 'selected';
                }
                
                return `
                    <label class="${className.trim()}">
                        <input type="radio" name="q${q.id}" value="${o.label}" 
                               ${isSelected ? 'checked' : ''} onchange="saveAnswer(${q.id}, '${o.label}')">
                        (${o.label}) ${escapeHtml(o.text)}
                    </label>
                `;
            }).join("");
            
            // ç”Ÿæˆç‹€æ…‹æ¨™ç¤º - ç§»é™¤é è¨­æ¨™ç¤º
            let statusHTML = '';
            
            return `
                <div class="quiz-card" id="card-${q.id}">
                    <div class="question-header">
                        <div class="question-title">ç¬¬ ${q.id} é¡Œ</div>
                        <div class="question-points">${q.singlePoints}åˆ†</div>
                    </div>
                    <div style="margin-bottom: 15px; color: #2c3e50; font-weight: normal; line-height: 1.5;">
                        ${escapeHtml(q.content)}
                    </div>
                    ${statusHTML}
                    <div class="options-list">
                        ${optionsHTML}
                    </div>
                    ${q.correct && q.correct !== '' ? 
                        `<div class="correct-ans" id="ans-${q.id}" style="display:none;">ã€æ­£ç¢ºç­”æ¡ˆï¼š${q.correct}ã€‘</div>` : 
                        ''
                    }
                </div>
            `;
        }).join("");
    }

    // å„²å­˜ä½¿ç”¨è€…ç­”æ¡ˆ
    function saveAnswer(questionId, answer) {
        userAnswers[questionId] = answer;
        console.log(`å„²å­˜ç­”æ¡ˆï¼šç¬¬ ${questionId} é¡Œ = ${answer}`);
        
        // æ›´æ–°é¸é …æ¨£å¼
        const card = document.getElementById(`card-${questionId}`);
        if (card) {
            // ç§»é™¤æ‰€æœ‰é¸é …çš„selectedé¡åˆ¥
            const labels = card.querySelectorAll('.options-list label');
            labels.forEach(label => {
                label.classList.remove('selected');
            });
            
            // æ·»åŠ ç•¶å‰é¸æ“‡çš„é¸é …selectedé¡åˆ¥
            const selectedLabel = card.querySelector(`input[value="${answer}"]`).parentElement;
            if (selectedLabel) {
                selectedLabel.classList.add('selected');
            }
        }
    }

    // é€å‡ºæ‰€æœ‰ç­”æ¡ˆ
    function submitAllAnswers() {
        const unansweredCount = finalData.filter(q => !userAnswers[q.id] || userAnswers[q.id] === '').length;
        
        if (unansweredCount > 0) {
            if (!confirm(`æ‚¨é‚„æœ‰ ${unansweredCount} é¡Œæœªä½œç­”ï¼Œç¢ºå®šè¦é€å‡ºå—ï¼Ÿ`)) {
                return;
            }
        }
        
        showUpdateStatus('ç­”æ¡ˆå·²é€å‡ºï¼æ‚¨å¯ä»¥ç¾åœ¨å°ç­”æ¡ˆæˆ–ç¨å¾Œè¨ˆç®—åˆ†æ•¸ã€‚');
    }

    // å°ç­”æ¡ˆ
    function checkAllAnswers() {
        if (!finalData.length) {
            showUpdateStatus('è«‹å…ˆè¼‰å…¥è€ƒå·ï¼', true);
            return;
        }
        
        // æª¢æŸ¥æ˜¯å¦æœ‰æ­£ç¢ºç­”æ¡ˆ
        const hasCorrectAnswers = finalData.some(q => q.correct && q.correct !== '');
        if (!hasCorrectAnswers) {
            showUpdateStatus('è«‹å…ˆè¼‰å…¥ç­”æ¡ˆå·ï¼', true);
            return;
        }
        
        // æ›´æ–°æ‰€æœ‰é¡Œç›®çš„é¡¯ç¤ºç‹€æ…‹
        finalData.forEach(q => {
            const card = document.getElementById(`card-${q.id}`);
            const userAnswer = userAnswers[q.id] || '';
            const correctAnswer = q.correct || '';
            
            if (card) {
                card.classList.remove('correct', 'incorrect', 'unanswered');
                
                if (userAnswer === '') {
                    card.classList.add('unanswered');
                } else if (userAnswer === correctAnswer) {
                    card.classList.add('correct');
                } else {
                    card.classList.add('incorrect');
                }
                
                // æ›´æ–°é¸é …æ¨£å¼
                const labels = card.querySelectorAll('.options-list label');
                labels.forEach(label => {
                    label.classList.remove('correct-option', 'incorrect-option');
                    
                    const optionValue = label.querySelector('input').value;
                    if (optionValue === correctAnswer) {
                        label.classList.add('correct-option');
                    }
                    if (userAnswer === optionValue && userAnswer !== correctAnswer) {
                        label.classList.add('incorrect-option');
                    }
                });
                
                // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
                const correctAnsDiv = document.getElementById(`ans-${q.id}`);
                if (correctAnsDiv) {
                    correctAnsDiv.style.display = 'block';
                }
            }
        });
        
        showUpdateStatus('ç­”æ¡ˆæ¯”å°å®Œæˆï¼æ·¡ç¶ è‰²è¡¨ç¤ºæ­£ç¢ºï¼Œæ·¡ç´…è‰²è¡¨ç¤ºéŒ¯èª¤ï¼Œæ·¡ç°è‰²è¡¨ç¤ºæœªä½œç­”ã€‚');
    }

    // è¨ˆç®—åˆ†æ•¸
    function calculateScore() {
        if (!finalData.length) {
            showUpdateStatus('è«‹å…ˆè¼‰å…¥è€ƒå·ï¼', true);
            return;
        }
        
        // æª¢æŸ¥æ˜¯å¦æœ‰æ­£ç¢ºç­”æ¡ˆ
        const hasCorrectAnswers = finalData.some(q => q.correct && q.correct !== '');
        if (!hasCorrectAnswers) {
            showUpdateStatus('è«‹å…ˆè¼‰å…¥ç­”æ¡ˆå·ï¼', true);
            return;
        }
        
        let correctCount = 0;
        let incorrectCount = 0;
        let unansweredCount = 0;
        let totalScore = 0;
        let maxScore = 0;
        
        examResults = [];
        
        // è¨ˆç®—åˆ†æ•¸
        finalData.forEach(q => {
            const userAnswer = userAnswers[q.id] || '';
            const correctAnswer = q.correct || '';
            const points = q.singlePoints || 2;
            maxScore += points;
            
            let result = {
                id: q.id,
                correctAnswer: correctAnswer,
                userAnswer: userAnswer,
                points: points,
                score: 0,
                status: 'unanswered'
            };
            
            if (userAnswer === '') {
                unansweredCount++;
                result.status = 'unanswered';
            } else if (userAnswer === correctAnswer) {
                correctCount++;
                totalScore += points;
                result.score = points;
                result.status = 'correct';
            } else {
                incorrectCount++;
                result.status = 'incorrect';
            }
            
            examResults.push(result);
        });
        
        // è¨ˆç®—æ­£ç¢ºç‡
        const accuracyRate = correctCount > 0 ? (correctCount / (correctCount + incorrectCount) * 100).toFixed(1) : 0;
        const percentage = (totalScore / maxScore * 100).toFixed(1);
        
        // é¡¯ç¤ºåˆ†æ•¸
        document.getElementById('score-box').style.display = 'block';
        document.getElementById('total-score').textContent = totalScore;
        document.getElementById('score-percentage').textContent = `${percentage}%`;
        document.getElementById('correct-count').textContent = correctCount;
        document.getElementById('incorrect-count').textContent = incorrectCount;
        document.getElementById('unanswered-count').textContent = unansweredCount;
        document.getElementById('accuracy-rate').textContent = `${accuracyRate}%`;
        
        // é¡¯ç¤ºè©³ç´°å ±å‘Š
        showScoreDetails();
        
        showUpdateStatus(`åˆ†æ•¸è¨ˆç®—å®Œæˆï¼æ‚¨çš„å¾—åˆ†ï¼š${totalScore}/${maxScore} (${percentage}%)`);
    }

    // é¡¯ç¤ºåˆ†æ•¸è©³ç´°è³‡è¨Š
    function showScoreDetails() {
        const detailsDiv = document.getElementById('score-details');
        const tableBody = document.getElementById('score-table-body');
        
        if (!detailsDiv || !tableBody) return;
        
        tableBody.innerHTML = '';
        
        examResults.forEach(result => {
            const row = document.createElement('tr');
            
            // ç‹€æ…‹æ¨™ç¤º
            let statusHTML = '';
            let statusClass = '';
            switch(result.status) {
                case 'correct':
                    statusHTML = '<span style="color:#28a745;">âœ“ æ­£ç¢º</span>';
                    statusClass = 'table-success';
                    break;
                case 'incorrect':
                    statusHTML = '<span style="color:#dc3545;">âœ— éŒ¯èª¤</span>';
                    statusClass = 'table-danger';
                    break;
                case 'unanswered':
                    statusHTML = '<span style="color:#6c757d;">â—‹ æœªç­”</span>';
                    statusClass = 'table-secondary';
                    break;
            }
            
            row.className = statusClass;
            row.innerHTML = `
                <td>${result.id}</td>
                <td>${result.correctAnswer || 'æœªè¼‰å…¥'}</td>
                <td>${result.userAnswer || 'æœªä½œç­”'}</td>
                <td>${statusHTML}</td>
                <td>${result.score}</td>
            `;
            
            tableBody.appendChild(row);
        });
        
        detailsDiv.style.display = 'block';
    }

    // é‡è¨­æ‰€æœ‰ç­”æ¡ˆ
    function resetAllAnswers() {
        if (!confirm('ç¢ºå®šè¦é‡è¨­æ‰€æœ‰ç­”æ¡ˆå—ï¼Ÿé€™å°‡æ¸…é™¤æ‚¨æ‰€æœ‰çš„ä½œç­”ç´€éŒ„ã€‚')) {
            return;
        }
        
        userAnswers = {};
        examResults = [];
        
        // éš±è—åˆ†æ•¸é¡¯ç¤º
        document.getElementById('score-box').style.display = 'none';
        document.getElementById('score-details').style.display = 'none';
        
        // é‡æ–°æ¸²æŸ“UI
        renderUI();
        
        showUpdateStatus('æ‰€æœ‰ç­”æ¡ˆå·²é‡è¨­ï¼');
    }

    // è¨ˆæ™‚å™¨
    function startTimer() {
        let s = 0; 
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            s++;
            let h = Math.floor(s/3600), m = Math.floor((s%3600)/60), sec = s%60;
            const timerDisplay = document.getElementById('timer-display');
            if (timerDisplay) {
                timerDisplay.innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
            }
        }, 1000);
    }

    // HTMLè½‰ç¾©
    function escapeHtml(text) {
        return text.replace(/&/g, "&amp;")
                   .replace(/</g, "&lt;")
                   .replace(/>/g, "&gt;")
                   .replace(/"/g, "&quot;")
                   .replace(/'/g, "&#039;");
    }

    // åŒ¯å‡ºåŠŸèƒ½
    function exportToCSV() {
        const csvContent = "data:text/csv;charset=utf-8," 
            + "é¡Œè™Ÿ,ç­”æ¡ˆ\n" 
            + fullAnsSequence.map((ans, idx) => `${idx + 1},${ans}`).join("\n");
        
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "ç­”æ¡ˆåŒ¯å‡º.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // æ¸…ç©ºç´€éŒ„
    function clearRecords() {
        if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ç´€éŒ„å—ï¼Ÿ")) {
            localStorage.clear();
            fullAnsSequence = new Array(50).fill("");
            userAnswers = {};
            examResults = [];
            updateVisualGrid();
            showUpdateStatus("ç´€éŒ„å·²æ¸…ç©ºï¼");
        }
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        initCutControls();
        initGrid();
        updateConfigSummary();
        updateTrimInfoDisplay();
        
        // é è¨­é¡¯ç¤ºç­”æ¡ˆå·è¨­å®š
        switchFileType('ans');
    });
</script>
</body>
</html>
